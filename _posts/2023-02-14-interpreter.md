---
layout: post
title:  "write a C interpreter"
date:   2023-02-13 09:54:44 -0600
categories: interpreter C
---

### 一般编译器编写分为三个步骤：
- 1.词法分析器
- 2.语法分析器
- 3.目标代码生成

### 构建编译器四个函数：
- 1.next() 词法分析，获取下一个标记，自动忽略空白字符
- 2.program() 语法分析的入口，分析整个程序
- 3.expression(level) 解析一个表达式
- 4.eval() 虚拟机入口，解释目标代码

### 计算机内部工作原理
三个部件：CPU、寄存器、内存
代码（汇编指令）以二进制的形式保存在内存中，CPU从中一条一条加载指令执行，程序运行状态保存于寄存器

- 1.代码段（text）用于存放代码（指令）
- 2.数据段（data）用于存放初始化了的数据，如int i = 10;，就需要存放到数据段中
- 3.未初始化数据段（bss）用于存放未初始化的数据，如 int i[1000];，因为不关心其中的真正数值，所以单独存放可以节省空间，减少程序的体积
- 4.栈（stack）用于处理函数调用相关的数据，如调用帧（calling frame）或是函数的局部变量等
- 5.堆（heap）用于为程序动态分配内存

```
+------------------+
|    stack   |     |      high address
|    ...     v     |
|                  |
|                  |
|                  |
|                  |
|    ...     ^     |
|    heap    |     |
+------------------+
| bss  segment     |
+------------------+
| data segment     |
+------------------+
| text segment     |      low address
+------------------+
```

